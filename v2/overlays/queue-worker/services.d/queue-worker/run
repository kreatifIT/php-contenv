#!/command/with-contenv /bin/bash
set -euo pipefail

if [[ ! -f /var/www/html/artisan ]]; then
  echo "[queue-worker] artisan not found; sleeping"
  exec tail -f /dev/null
fi

# Allow override via env
: "${QUEUE_CMD:=queue:work}"
: "${QUEUE_ARGS:=--verbose --tries=3 --timeout=90}"

echo "----> Starting Laravel queue worker: php artisan $QUEUE_CMD $QUEUE_ARGS"
exec /command/s6-setuidgid www-data \
  php /var/www/html/artisan $QUEUE_CMD $QUEUE_ARGS
